version: 2.1

workflows:
  version: 2
  build:
    jobs:
      - build_and_release
#          filters:
#            branches:
#              only:
#                - master


jobs:
  "build_and_release":
    working_directory: ~/repo
    docker:
      - image: cimg/base:2023.02
    steps:
      - setup_remote_docker:
          version: 20.10.22
      - checkout
      - run:
          name: install-docker-buildx
          command: |
            mkdir -vp ~/.docker/cli-plugins/
            curl --silent -L "https://github.com/docker/buildx/releases/download/v0.10.0/buildx-v0.10.0.linux-amd64" > ~/.docker/cli-plugins/docker-buildx
            chmod a+x ~/.docker/cli-plugins/docker-buildx
      - run:
          name: docker-deploy
          environment:
            TAG: $( curl -sL "https://api.github.com/repos/tdedobbeleer/soccer-ws/tags" | jq -r ".[].name" | head -n1 )
          command: sh ./scripts/docker_release.sh